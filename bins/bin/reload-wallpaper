#!/bin/bash
set -euo pipefail

WALLPAPER_DIR="$HOME/Pictures/wallpapers"

if ! pgrep -x hyprpaper >/dev/null; then
    echo "hyprpaper not running, starting it..."
    hyprpaper &
    sleep 1
fi

WALLPAPER=$(find "$WALLPAPER_DIR" -type f \( -name "*.jpg" -o -name "*.png" -o -name "*.webp" \) 2>/dev/null | shuf -n 1)

if [[ -z "$WALLPAPER" ]]; then
    echo "no wallpapers found in $WALLPAPER_DIR"
    exit 1
fi

hyprctl hyprpaper wallpaper ", $WALLPAPER"

echo "wallpaper set: $(basename "$WALLPAPER")"
